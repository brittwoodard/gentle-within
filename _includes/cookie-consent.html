<div id="cookieConsentBanner" class="p-2 bg-light m-2 md:w-[40%] fixed left-0 bottom-0 z-20 hidden">
    <div class="border border-dark bg-light p-5p">
        <div class="flex justify-between">
            <div class="text-center">
                <span>We value your privacy. With your consent, we use cookies to improve this space. They load only after Accept.</span>
            </div>
            <div class="text-right text-lg cursor-pointer ml-4">
                <span id="close-cookie-banner">X</span>
            </div>
        </div>
        <div class="flex justify-center mt-4">
            <a id="acceptCookies" class="button-cookies cursor-pointer">Accept</a>
            <a id="declineCookies" class="mx-4 button-cookies cursor-pointer">Decline</a>
        </div>
    </div>
</div>

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-GWFMFKQ299"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-GWFMFKQ299');
</script>

<!-- JS -->
<script>
  // Helpers
  function setCookie(name, value, days) {
    const maxAge = days * 24 * 60 * 60;
    const secure = location.protocol === 'https:' ? '; Secure' : '';
    document.cookie = `${name}=${value}; Path=/; Max-Age=${maxAge}; SameSite=Lax${secure}`;
  }
  function getCookie(name) {
    return document.cookie.split('; ').find(row => row.startsWith(name + '='))?.split('=')[1];
  }

  // Dynamically load GA only after consent
  function loadGAScript() {
    if (window.__gaLoaded) return; // guard
    const s = document.createElement('script');
    s.async = true;
    s.src = 'https://www.googletagmanager.com/gtag/js?id=G-GWFMFKQ299';
    s.onload = () => {
      window.dataLayer = window.dataLayer || [];
      function gtag(){ dataLayer.push(arguments); }
      window.gtag = gtag;
      gtag('js', new Date());
      gtag('config', 'G-GWFMFKQ299');
      window.__gaLoaded = true;
    };
    document.head.appendChild(s);
  }

  function acceptCookies() {
    setCookie('cookiesConsent', 'accepted', 365);
    document.getElementById('cookieConsentBanner').style.display = 'none';
    loadGAScript();
  }

  function declineCookies() {
    setCookie('cookiesConsent', 'declined', 365);
    document.getElementById('cookieConsentBanner').style.display = 'none';
    // Do NOT load GA
  }

  function closeCookieBanner() {
    // Treat closing as 'declined' so we don't pester people across pages
    declineCookies();
  }

  // Wire up buttons
  document.addEventListener('DOMContentLoaded', () => {
    const consent = getCookie('cookiesConsent');
    if (consent === 'accepted') {
      loadGAScript();
      document.getElementById('cookieConsentBanner').style.display = 'none';
    } else if (consent === 'declined') {
      document.getElementById('cookieConsentBanner').style.display = 'none';
    } else {
      document.getElementById('cookieConsentBanner').style.display = 'block';
    }

    document.getElementById('acceptCookies').addEventListener('click', acceptCookies);
    document.getElementById('declineCookies').addEventListener('click', declineCookies);
    document.getElementById('close-cookie-banner').addEventListener('click', closeCookieBanner);
  });
</script>
